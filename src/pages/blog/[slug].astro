---
import Nav from '../../components/Nav.astro';
import Footer from '../../components/Footer.astro';

// Generate static paths for all MDX posts
export async function getStaticPaths() {
  const modules = import.meta.glob('../../content/posts/*.mdx', { eager: true });
  return Object.keys(modules).map(filePath => {
    const file = filePath.split('/').pop();
    const slug = file.replace(/\.mdx$/, '');
    return { params: { slug } };
  });
}

const { params } = Astro;
const slug = params.slug;

// Eagerly import MDX modules at build-time and render the matching post.
const modules = import.meta.glob('../../content/posts/*.mdx', { eager: true });
const key = Object.keys(modules).find(k => k.endsWith(`/${slug}.mdx`));
const mod = key ? modules[key] : null;
if (!mod) {
  throw new Error('Post not found');
}
const Content = mod.default;
const frontmatter = mod.frontmatter || {};
---
<html lang="en">
  <head>
    <title>{frontmatter.title ?? slug} â€” MySite</title>
  </head>
  <body>
    <Nav />
    <main class="container py-12">
      <article class="prose">
        <h1 class="text-2xl font-bold">{frontmatter.title ?? slug}</h1>
        {frontmatter.date && <p class="muted">{frontmatter.date}</p>}
        <Content />
      </article>
    </main>
    <Footer />
  </body>
</html>
