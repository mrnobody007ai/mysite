---
import Nav from '../../components/Nav.astro';
import Footer from '../../components/Footer.astro';
import SEO from '../../components/SEO.astro';

// Eagerly import all MDX posts at build time using Vite's glob.
const modules = import.meta.glob('../../content/posts/*.mdx', { eager: true });
const posts = Object.entries(modules).map(([filePath, mod]) => {
  const file = filePath.split('/').pop();
  const slug = file.replace(/\.mdx$/, '');
  const title = mod.frontmatter?.title ?? slug;
  const date = mod.frontmatter?.date ?? '';
  return { slug, title, date };
}).sort((a, b) => (b.date || '').localeCompare(a.date || ''));
---
<html lang="en">
  <SEO title="Blog â€” MySite" description="Tech and self-hosting guides." />
  <body>
    <Nav />
    <main class="container py-12">
      <h1 class="text-2xl font-bold">Blog</h1>
      <p class="mt-3 muted">Step-by-step self-hosting tutorials, YouTube writeups, and tech notes.</p>

      <ul class="mt-6 space-y-3">
        {posts.map(post => <li><a class="text-lg text-primary-500" href={`/blog/${post.slug}`}>{post.title}</a></li>)}
      </ul>
    </main>
    <Footer />
  </body>
</html>
